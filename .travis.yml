language: python
python:
  - "3.6"
sudo: required
services:
  - docker
matrix:
  include:
    - before_install:
        - sudo service mysql stop
      script:
        - docker-compose build
        - docker-compose up -d
        - docker-compose run web ./wait-for-it.sh web:8000 -t 70
        - docker-compose run web python manage.py test
    - env:
        - secure: SVo/3Z+JyMOpXZno2qZUN9AyL2O1Eaokv92zkOhg23zoBub6AVVaXV1N6f8s3ELOTcDiQ8dIwoTabgwR0Tsy5DN7QBsr4QOokw/MNOCds7zqDf6JtD3CxPVDIzPg0LgDASPZOxjpQi4ys96NJuF/1OtTfzFjoTAcqQwrvIsEGhf/ZEoCp8qrxbfp1CuNClRqbHOVPw4yUwz4cfIL3L7IYD+MDydd8oVQAQvD8bgNmwDhgDwnLKLkPQEUW7al2GqqOzeRk2IukuMXMhxr4vXwr4fK71KRwoDlftHZFIE9H1pULg7omYZIONa6cEYhX2Tff7OSxFKpY4kN4ni7Tk/1T+R/I8tGrJ79VGFRPGdIxA/xufcHpnfHwbRZRimY/ZkQVczBzoZqqt125jDTindJ00cH7a2e7twvJBZfBs2XBTlO+XxMyBUEvLlxCUBQpSzsQnTR9cJaPNK5RdRJN907W1RhRHsaSgbMOZXh0EzDwfLVVkJUe16xp+l9zXCusiqJ6liiXEJqJeTcMlu3P5kh/9zqjk8rTJ1rzvffOUBtowDcHj9rjSn4I3lEGatARXyYg2GLLW4pMn6LegHRTccy2+kwGVeHtqYFlU30/xDCDaxAS7RrvU3pmtvFQKbnvoUus2L3ovE/66JvierqnMIAGM5RtTrzi0pRh2/JU1tFKs8=
        - secure: idiDlLmsFECRBpgJWFxp6h6XwKTaSIymv1PsY1do6KvbGzCsSgmWWvBhzmKCutRxdcBdiGS9q6akSPTOzkjVAZ/og3N52ylcbdfINLEgVCGPBRmXXsmr873Y6KuvebMCWZhFtDqusw5N3SUiQGpOjHu7amoZVxHuvWkqtWoOPMOyd0JnmX+GCn7BEgNUAzz/Z5/mhLB9Lh5MJ3Ii3JbPgcKF3A/7qdChiMAQaEjKuS2a8/Tssg8gAHNwmMtXmYLlZDah4v5m7Ds2K/ezCIfv9tTgCFMfdzKp5cy46U2vu41gfJ6fFD8NYUHAnXWiz+KyuoTWjrcqlEeIHUY+bLmPVs2N40hB+9UkCWEyoYQW0wtvdddfiPhx3ZyaixEHwuxNqfGe7g2w6gmKWDAIMCsU5TrJi5NXbrLg6ZG7EukDo+bb7THFYktMSlq5fW2GDcYT2E1dDPBCKSNe8MoVs/1c0PS4HTG2vYNRXGcQlHcJNcZ+kciZFjTAPeLVD6svQte+N/JuQa4qmOeu+w2EYd+8288YdCVC1dwSTIVjDTTJqxbNmeI58uRmYuI3SXr37IQ95UjznZqRX5aV4vXsZor8HrREy+leqcfcN4Y/RsJTrKVslU1Z58MDs5OMIb0cOCU7nJir7iPu0K9C4vl3RhsnptoYeNiFREmLiEBjdoAY+xo=
        - secure: qt1M9LLy/BmCNXZJDX40lF0ihWBWbLpZYqXJQHrJQwVmx/4M46y7jKRga9rGhoKlXK+Yh4teGrexFG2qjMfJ7ig1qUdGxGKQ8MYaJY/jf4DiStEj/N0K4knCdB4HL2uDhPqh0nQqG4x09M5EQepN4Aat5DWpYSHHhJbzA+MVknVTXrK/XiFD17nLWvwPjtIRMAWmxLn4yeSODBj7GBEvGZsAhz9m4QAIt/LeqXwW7IYhzOIMu12i8yscRrbQh8eNBXuvrpL/3grIbMdT2lgVywiJ/AnYu0AvBmkhS4Gwc7JiOYEfNuSMQpmWHxwFWFHskkEnPbE3Dt5pPwH1eqTFMJ/bsnwfXP+tUBOisrhoGmMhR4LKDtGzg5UXaGxIs+vW34p4SX2D4lMcGnIQKjTZzzY92oMp3pt7T5RV+TothQqwmnPD4aKQ7xNNsHxO0EwAvknxwsi2y1sLS2/PDhRQUjoNFi+TrSjBzmQDUNdy1zs91PCXLNlIYu87sCOeVcHWCPzsdyzwWIed/QXWTaSIjcBWe1CtYf63Xeiue50tO45g38cb/XK2CS6sY4abezZ9z6tsd2yKF65XBysk4zACMdT0ENuQ2Xn+Y18ApNzTLN8n04fyRqHJSYxKpyL1MDfFYRcQmD8aQcRI6PaO7mm1UZROp2qpDzTP2SyoBvjD5MU=
        - secure: ia6rLhKuPVT+rYq3Q+dA7flinrirTEWWshexwWPBboGj52yjgaYMntCk3GoniIJRSQv/zim+2cQeupOXgAble/gOaT3Cq3acIbxKnKW5n7bXz8UaQjlPzTu+TbkWJ0RukB543f8w3AM0zsfVjG5FlgAEwLOTogCPxvMSFGYXy8iOho/jJ429IXfrm8mJk0e61+/3LBrztchYwSvAsmHxNK8fV5SSQCKh1DyuuL8kn/V5rhFdvzI1q1WskbPYvb46iIyGGeeyG+7OeOTuyXr8M6lUxuUcWj0mHymJIyNofRlI6Joy/6nU4ZCwMEozWlYnm684I1uj2+V5RMA3WLnLQkMmebG8U3Zugx0t7HOPmJwmGBg6jQHbxqTaQzxManuuoDmlFDPW/WB6d3Sqk3r7TfIo6b0IAeom5FD9aHiNJgKeajya8XjYAbflQkwQXdORqGsN3tMKn3zKZTgBYSDZRk3MQChYkKcPdICSGJRy6sJKo14zR559yV1U6LQu/GpyM5mQOIIhwSsppVEN8+r53ILLAJLSeYalhejkBzPCmOUEAg8WIVO3ds+xvixWvCej9BPcrM2oZKfY9aNVRb5TaBBnA7QuiVh0HsIW7ZL4T4rHYaOI7iTIZgk8h+S0RBdtJ3U+aVsEqmyGa/uXNRwSiaXzKOUdpZz2Iwojxj+Cm5E=
        - secure: NHOCbXWUhfs/niGdq2xFccYL7eKimRGxHe8U8ts5oQdGeTfc8+/QsZuW3NidupHAYOSENXNAXt+4P6Ur8v8eWHD0UiI1gtINShFhWE1mz6xmvyIQAy53OUv4pbILmaj5Ttmx1QuItX2TTt7qBYQA4zU+VXvPCiwSDi/GbK2TlkDmG86Ka/nlZHYTv60cMu6kKJUVg/NPCLUUttsfIASiM+T7N8jhHStN/+QuqfBXsd3XcsD/W411uYoUqnyFAcvq4VIobjvQGbesmy0oJltC2+2WnMFfShkPdy9xdAmyVAZmSgowS5wc828lgyjZR7+UjZVpPy2jQevtppCAqbiV9aMHl8oio8en1b50VqfW5qjEmSWyr0HawCl0G2v6jp6f60UMNrr+5txmbJboGy9Vg1tvVKUaE/7pyLHFy13MJyzPvjWUfT/oEJ1NzLr1YptxMgvfM4y6F3an70tU0xMn3WNmTCl8XQ0aNSfnTrNIBHhOYVJHcKpumjjkWEuu6AYL0aIov5mVagnHkI/4H7c4eGt/hiMp/TAcXnYQaMgyhW6SwgTGGxEkJoeFy6rHV7/MHUWZr6ZEeRLySQJN2JAqPlLi3pYP87UoX50W0DsDVWe+AhSHCR3PKJwtOKMQpp+TW9uCdi6pSpLlV3TT7pjz9nYzP0A6Y/O4hDibvMwkxpU=
        - secure: bQtREcRa7xgviYrKn2uzDxrgc3iO8jeFVohE4v7Sf3l8ssudE2q3r4yl3AzSrnCl1S1ALJTN1i1xiKsd+prdGmfdAR2jVPgMAz4h9llE+lz//RWkgiDbouNH+bUziFqr1V6fdsDfeKI0/ingbxr74p1aJWpQI6HgG9JTm58sYCcFvlJ/c3fyxg5uWAz8bybWh9kng0AmuyiQd8VH60hxAwZQ1ugkzIbFJD+VGvYW3bP3OOHN8uxnzV2UMwoZ3nwe8qPzaxSUaVJX+crNPAxxMF4fzBmmW5x0au+LFI3U1+24edN1WDLufsEZsOdOXrZQbhnLOorlrUQ2oPLoE4Hc8CyYmPgNPS4B4f0BG/v/CxIAzL4ZWe1U8UfouTF9NbZ8DXu8YLQPJT6J+wK+7hEJnTO/GuQebs1J1Zgm1x7eO+hVSvO2wdkChcVByEdzZ+f5/E2q4rUvzSLBdeaQHlDpfwBhjrK2Jq5tjQIQMmzzLVJkZulMzD5YRM5wjLr7jnjaqfWlowsKjzPNE1hWi5DBMALtgFIbv4YkEvTkTBOBpOJ4n/m7+Rwpj1Lj8xjKxwsr1wOTjxq5WXlB562EwqbWf+JCl2+a9iS5oXx6yqsF0B955BtnrRrtgk6BTiT+LnbnZuMZuSiQeu68be2aPgf0Hana/667pau9V/R1S/zeMvg=
        - secure: iZFJAAcJHu8cBNrTwO2MgEDR5vkuwqsAjJd/O8ENNOlqfChrh4VfMXE3YjjE9d/0b0tnaPP6zw1UwY1+yhrE9rhcfgOJW3ovDad+VgX+dxLD9NRdEPuGma/5ugeNCzvFGeb0R1EjBfKngVjKCQKHF+6mbXDJ+oN47YMqGAo2VcmtQL7nI5MTSA/Swx859cjlTK1OhxpgLv6QFzosyIl4RzXNpfCL2tz7P9S4UyEqHDowcl08/x+DEfpDxKK3pN9P6Z3RIiJ5qkncRrSk5tkNctm6STVvqPUMvfntzklb9Whfjo3XMC97/EA4hyBF5zW3397+V3Zicj+ELY+AiZg9hYSp0T5N88nmp74vmsW530MMnYAXpF0sY6xxxcUyAR0L9ulOtEfdVFWC9Rf0LFL9bxeQJ6+GF36bcUn48hpvlySRHxrSclrdvi9jGJB1IMOrNm5WdGvDFBosH5Lwr2aX37sCRozL3uyyQicT2z1JT0uUtighrs5utewpVjA5QveYP9N77SbNNDHi1g9rRWcfGn1WOuuNyKXrwulVjw+LSa5WIt2oKwkl1zAV/gva8b+FfirSV9clCmPLgJdnbWyvnpAB5P9kWOSW3gWiZ/wXw7q9uoa0eu+BlHYFD4YPiYLD9jMiL19W904HHb/PnCf8nkMx4a399jetkLsQsjFYItY=
        - secure: abgiz/T/IyimlYJfP4v3Q4P4Y5cYn2h9B0j2YVLBy0/TvkG594KVdlqcKRLmd0X8SXM2kpG9v0kCIpCoGlF+KG2whNRyAEkUtrupuBd0tZKcaKAlBQpCwLZ66EK52ckpP1nIZKu5nsrWNIYooKrFBZ+LIkU8kEB43S230qInCxEHaevhebLLsIa9pubFwYHZtzXm7EaPx/XX1VFUn9GApKZcJ5UTDomoBy+h7GA3gKz58N76O7TrN46td3y65jtGzEgKGfsgqi85q+w/1n1DVPBz60lGfgPM8I55tg5X/XuChfdmLdK0rvDWpvjfUezeYUrqj1yG9vrBtZfPA7MPv9sVuBh8Vl5sg08/boxFxb8KKLvUN8dPkKf4Va+Gwvxg85LmqPpGAM0L8fYzIzxLHB6u9fnGFO/RyeYNc4SRx/hJqKBeaehpkfis86NmtG3YqgaoOeJr8du16x7SedYeYNX4jk13dZvl3EkqVd/nN9Ui/DrFZlPmSZZInJGBS4hE3o9EZqDWM2jTsMzK6guB0T62ESFMagZPHYHA/Fk1U6ecNBSJi6G5YAxHip/sQBlkAQ+B8XBmXX+xTelAQp+MvpFeIIxG6h9y58cOmOgOtKDyeuYgn1B8NOqjr8jP6vB9E2Or/mImFdwcsjhDgZqSY7iWFe6rE87B2qnclHYXV08=
      before_install:
        - sudo service mysql stop
      script:
        - docker-compose -f docker-compose.yml -f docker-compose.prod.yml build
        - docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
        - docker-compose -f docker-compose.yml -f docker-compose.prod.yml run web ./wait-for-it.sh web:8000 -t 70
        - docker-compose -f docker-compose.yml -f docker-compose.prod.yml run web python manage.py test
branches:
  only:
    - master
    - develop
